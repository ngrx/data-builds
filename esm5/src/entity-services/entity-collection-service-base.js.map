{"version":3,"file":"entity-collection-service-base.js","sourceRoot":"ng://@ngrx/data/","sources":["src/entity-services/entity-collection-service-base.ts"],"names":[],"mappings":"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","sourcesContent":["import { Action, Store } from '@ngrx/store';\nimport { Dictionary, IdSelector, Update } from '@ngrx/entity';\n\nimport { Observable } from 'rxjs';\n\nimport { EntityAction, EntityActionOptions } from '../actions/entity-action';\nimport { EntityActionGuard } from '../actions/entity-action-guard';\nimport {\n  EntityCollection,\n  ChangeStateMap,\n} from '../reducers/entity-collection';\nimport { EntityDispatcher } from '../dispatchers/entity-dispatcher';\nimport { EntityCollectionService } from './entity-collection-service';\nimport { EntityCollectionServiceElementsFactory } from './entity-collection-service-elements-factory';\nimport { EntityOp } from '../actions/entity-op';\nimport { EntitySelectors } from '../selectors/entity-selectors';\nimport { EntitySelectors$ } from '../selectors/entity-selectors$';\nimport { QueryParams } from '../dataservices/interfaces';\n\n// tslint:disable:member-ordering\n\n/**\n * Base class for a concrete EntityCollectionService<T>.\n * Can be instantiated. Cannot be injected. Use EntityCollectionServiceFactory to create.\n * @param EntityCollectionServiceElements The ingredients for this service\n * as a source of supporting services for creating an EntityCollectionService<T> instance.\n */\nexport class EntityCollectionServiceBase<\n  T,\n  S$ extends EntitySelectors$<T> = EntitySelectors$<T>\n> implements EntityCollectionService<T> {\n  /** Dispatcher of EntityCommands (EntityActions) */\n  readonly dispatcher: EntityDispatcher<T>;\n\n  /** All selectors of entity collection properties */\n  readonly selectors: EntitySelectors<T>;\n\n  /** All selectors$ (observables of entity collection properties) */\n  readonly selectors$: S$;\n\n  constructor(\n    /** Name of the entity type of this collection service */\n    public readonly entityName: string,\n    /** Creates the core elements of the EntityCollectionService for this entity type */\n    serviceElementsFactory: EntityCollectionServiceElementsFactory\n  ) {\n    entityName = entityName.trim();\n    const { dispatcher, selectors, selectors$ } = serviceElementsFactory.create<\n      T,\n      S$\n    >(entityName);\n\n    this.entityName = entityName;\n    this.dispatcher = dispatcher;\n    this.guard = dispatcher.guard;\n    this.selectId = dispatcher.selectId;\n    this.toUpdate = dispatcher.toUpdate;\n\n    this.selectors = selectors;\n    this.selectors$ = selectors$;\n    this.collection$ = selectors$.collection$;\n    this.count$ = selectors$.count$;\n    this.entities$ = selectors$.entities$;\n    this.entityActions$ = selectors$.entityActions$;\n    this.entityMap$ = selectors$.entityMap$;\n    this.errors$ = selectors$.errors$;\n    this.filter$ = selectors$.filter$;\n    this.filteredEntities$ = selectors$.filteredEntities$;\n    this.keys$ = selectors$.keys$;\n    this.loaded$ = selectors$.loaded$;\n    this.loading$ = selectors$.loading$;\n    this.changeState$ = selectors$.changeState$;\n  }\n\n  /**\n   * Create an {EntityAction} for this entity type.\n   * @param op {EntityOp} the entity operation\n   * @param [data] the action data\n   * @param [options] additional options\n   * @returns the EntityAction\n   */\n  createEntityAction<P = any>(\n    op: EntityOp,\n    data?: P,\n    options?: EntityActionOptions\n  ): EntityAction<P> {\n    return this.dispatcher.createEntityAction(op, data, options);\n  }\n\n  /**\n   * Create an {EntityAction} for this entity type and\n   * dispatch it immediately to the store.\n   * @param op {EntityOp} the entity operation\n   * @param [data] the action data\n   * @param [options] additional options\n   * @returns the dispatched EntityAction\n   */\n  createAndDispatch<P = any>(\n    op: EntityOp,\n    data?: P,\n    options?: EntityActionOptions\n  ): EntityAction<P> {\n    return this.dispatcher.createAndDispatch(op, data, options);\n  }\n\n  /**\n   * Dispatch an action of any type to the ngrx store.\n   * @param action the Action\n   * @returns the dispatched Action\n   */\n  dispatch(action: Action): Action {\n    return this.dispatcher.dispatch(action);\n  }\n\n  /** The NgRx Store for the {EntityCache} */\n  get store() {\n    return this.dispatcher.store;\n  }\n\n  /**\n   * Utility class with methods to validate EntityAction payloads.\n   */\n  guard: EntityActionGuard<T>;\n\n  /** Returns the primary key (id) of this entity */\n  selectId: IdSelector<T>;\n\n  /**\n   * Convert an entity (or partial entity) into the `Update<T>` object\n   * `update...` and `upsert...` methods take `Update<T>` args\n   */\n  toUpdate: (entity: Partial<T>) => Update<T>;\n\n  // region Dispatch commands\n\n  /**\n   * Dispatch action to save a new entity to remote storage.\n   * @param entity entity to add, which may omit its key if pessimistic and the server creates the key;\n   * must have a key if optimistic save.\n   * @param [options] options that influence save and merge behavior\n   * @returns Observable of the entity\n   * after server reports successful save or the save error.\n   */\n  add(entity: T, options?: EntityActionOptions): Observable<T> {\n    return this.dispatcher.add(entity, options);\n  }\n\n  /**\n   * Dispatch action to cancel the persistence operation (query or save) with the given correlationId.\n   * @param correlationId The correlation id for the corresponding EntityAction\n   * @param [reason] explains why canceled and by whom.\n   * @param [options] options such as the tag and mergeStrategy\n   */\n  cancel(\n    correlationId: any,\n    reason?: string,\n    options?: EntityActionOptions\n  ): void {\n    this.dispatcher.cancel(correlationId, reason, options);\n  }\n\n  /**\n   * Dispatch action to delete entity from remote storage by key.\n   * @param key The entity to delete\n   * @param [options] options that influence save and merge behavior\n   * @returns Observable of the deleted key\n   * after server reports successful save or the save error.\n   */\n  delete(entity: T, options?: EntityActionOptions): Observable<number | string>;\n\n  /**\n   * Dispatch action to delete entity from remote storage by key.\n   * @param key The primary key of the entity to remove\n   * @param [options] options that influence save and merge behavior\n   * @returns Observable of the deleted key\n   * after server reports successful save or the save error.\n   */\n  delete(\n    key: number | string,\n    options?: EntityActionOptions\n  ): Observable<number | string>;\n  delete(\n    arg: number | string | T,\n    options?: EntityActionOptions\n  ): Observable<number | string> {\n    return this.dispatcher.delete(arg as any, options);\n  }\n\n  /**\n   * Dispatch action to query remote storage for all entities and\n   * merge the queried entities into the cached collection.\n   * @param [options] options that influence merge behavior\n   * @returns Observable of the collection\n   * after server reports successful query or the query error.\n   * @see load()\n   */\n  getAll(options?: EntityActionOptions): Observable<T[]> {\n    return this.dispatcher.getAll(options);\n  }\n\n  /**\n   * Dispatch action to query remote storage for the entity with this primary key.\n   * If the server returns an entity,\n   * merge it into the cached collection.\n   * @param key The primary key of the entity to get.\n   * @param [options] options that influence merge behavior\n   * @returns Observable of the queried entity that is in the collection\n   * after server reports success or the query error.\n   */\n  getByKey(key: any, options?: EntityActionOptions): Observable<T> {\n    return this.dispatcher.getByKey(key, options);\n  }\n\n  /**\n   * Dispatch action to query remote storage for the entities that satisfy a query expressed\n   * with either a query parameter map or an HTTP URL query string,\n   * and merge the results into the cached collection.\n   * @param queryParams the query in a form understood by the server\n   * @param [options] options that influence merge behavior\n   * @returns Observable of the queried entities\n   * after server reports successful query or the query error.\n   */\n  getWithQuery(\n    queryParams: QueryParams | string,\n    options?: EntityActionOptions\n  ): Observable<T[]> {\n    return this.dispatcher.getWithQuery(queryParams, options);\n  }\n\n  /**\n   * Dispatch action to query remote storage for all entities and\n   * completely replace the cached collection with the queried entities.\n   * @param [options] options that influence load behavior\n   * @returns Observable of the collection\n   * after server reports successful query or the query error.\n   * @see getAll\n   */\n  load(options?: EntityActionOptions): Observable<T[]> {\n    return this.dispatcher.load(options);\n  }\n\n  /**\n   * Dispatch action to save the updated entity (or partial entity) in remote storage.\n   * The update entity may be partial (but must have its key)\n   * in which case it patches the existing entity.\n   * @param entity update entity, which might be a partial of T but must at least have its key.\n   * @param [options] options that influence save and merge behavior\n   * @returns Observable of the updated entity\n   * after server reports successful save or the save error.\n   */\n  update(entity: Partial<T>, options?: EntityActionOptions): Observable<T> {\n    return this.dispatcher.update(entity, options);\n  }\n\n  /**\n   * Dispatch action to save a new or existing entity to remote storage.\n   * Call only if the server supports upsert.\n   * @param entity entity to add or upsert.\n   * It may omit its key if an add, and is pessimistic, and the server creates the key;\n   * must have a key if optimistic save.\n   * @param [options] options that influence save and merge behavior\n   * @returns Observable of the entity\n   * after server reports successful save or the save error.\n   */\n  upsert(entity: T, options?: EntityActionOptions): Observable<T> {\n    return this.dispatcher.upsert(entity, options);\n  }\n\n  /*** Cache-only operations that do not update remote storage ***/\n\n  /**\n   * Replace all entities in the cached collection.\n   * Does not save to remote storage.\n   * @param entities to add directly to cache.\n   * @param [options] options such as mergeStrategy\n   */\n  addAllToCache(entities: T[], options?: EntityActionOptions): void {\n    this.dispatcher.addAllToCache(entities, options);\n  }\n\n  /**\n   * Add a new entity directly to the cache.\n   * Does not save to remote storage.\n   * Ignored if an entity with the same primary key is already in cache.\n   * @param entity to add directly to cache.\n   * @param [options] options such as mergeStrategy\n   */\n  addOneToCache(entity: T, options?: EntityActionOptions): void {\n    this.dispatcher.addOneToCache(entity, options);\n  }\n\n  /**\n   * Add multiple new entities directly to the cache.\n   * Does not save to remote storage.\n   * Entities with primary keys already in cache are ignored.\n   * @param entities to add directly to cache.\n   * @param [options] options such as mergeStrategy\n   */\n  addManyToCache(entities: T[], options?: EntityActionOptions): void {\n    this.dispatcher.addManyToCache(entities, options);\n  }\n\n  /** Clear the cached entity collection */\n  clearCache(): void {\n    this.dispatcher.clearCache();\n  }\n\n  /**\n   * Remove an entity directly from the cache.\n   * Does not delete that entity from remote storage.\n   * @param entity The entity to remove\n   * @param [options] options such as mergeStrategy\n   */\n  removeOneFromCache(entity: T, options?: EntityActionOptions): void;\n\n  /**\n   * Remove an entity directly from the cache.\n   * Does not delete that entity from remote storage.\n   * @param key The primary key of the entity to remove\n   * @param [options] options such as mergeStrategy\n   */\n  removeOneFromCache(key: number | string, options?: EntityActionOptions): void;\n  removeOneFromCache(\n    arg: (number | string) | T,\n    options?: EntityActionOptions\n  ): void {\n    this.dispatcher.removeOneFromCache(arg as any, options);\n  }\n\n  /**\n   * Remove multiple entities directly from the cache.\n   * Does not delete these entities from remote storage.\n   * @param entity The entities to remove\n   * @param [options] options such as mergeStrategy\n   */\n  removeManyFromCache(entities: T[], options?: EntityActionOptions): void;\n\n  /**\n   * Remove multiple entities directly from the cache.\n   * Does not delete these entities from remote storage.\n   * @param keys The primary keys of the entities to remove\n   * @param [options] options such as mergeStrategy\n   */\n  removeManyFromCache(\n    keys: (number | string)[],\n    options?: EntityActionOptions\n  ): void;\n  removeManyFromCache(\n    args: (number | string)[] | T[],\n    options?: EntityActionOptions\n  ): void {\n    this.dispatcher.removeManyFromCache(args as any[], options);\n  }\n\n  /**\n   * Update a cached entity directly.\n   * Does not update that entity in remote storage.\n   * Ignored if an entity with matching primary key is not in cache.\n   * The update entity may be partial (but must have its key)\n   * in which case it patches the existing entity.\n   * @param entity to update directly in cache.\n   * @param [options] options such as mergeStrategy\n   */\n  updateOneInCache(entity: Partial<T>, options?: EntityActionOptions): void {\n    // update entity might be a partial of T but must at least have its key.\n    // pass the Update<T> structure as the payload\n    this.dispatcher.updateOneInCache(entity, options);\n  }\n\n  /**\n   * Update multiple cached entities directly.\n   * Does not update these entities in remote storage.\n   * Entities whose primary keys are not in cache are ignored.\n   * Update entities may be partial but must at least have their keys.\n   * such partial entities patch their cached counterparts.\n   * @param entities to update directly in cache.\n   * @param [options] options such as mergeStrategy\n   */\n  updateManyInCache(\n    entities: Partial<T>[],\n    options?: EntityActionOptions\n  ): void {\n    this.dispatcher.updateManyInCache(entities, options);\n  }\n\n  /**\n   * Insert or update a cached entity directly.\n   * Does not save to remote storage.\n   * Upsert entity might be a partial of T but must at least have its key.\n   * Pass the Update<T> structure as the payload.\n   * @param entity to upsert directly in cache.\n   * @param [options] options such as mergeStrategy\n   */\n  upsertOneInCache(entity: Partial<T>, options?: EntityActionOptions): void {\n    this.dispatcher.upsertOneInCache(entity, options);\n  }\n\n  /**\n   * Insert or update multiple cached entities directly.\n   * Does not save to remote storage.\n   * Upsert entities might be partial but must at least have their keys.\n   * Pass an array of the Update<T> structure as the payload.\n   * @param entities to upsert directly in cache.\n   * @param [options] options such as mergeStrategy\n   */\n  upsertManyInCache(\n    entities: Partial<T>[],\n    options?: EntityActionOptions\n  ): void {\n    this.dispatcher.upsertManyInCache(entities, options);\n  }\n\n  /**\n   * Set the pattern that the collection's filter applies\n   * when using the `filteredEntities` selector.\n   */\n  setFilter(pattern: any): void {\n    this.dispatcher.setFilter(pattern);\n  }\n\n  /** Set the loaded flag */\n  setLoaded(isLoaded: boolean): void {\n    this.dispatcher.setLoaded(!!isLoaded);\n  }\n\n  /** Set the loading flag */\n  setLoading(isLoading: boolean): void {\n    this.dispatcher.setLoading(!!isLoading);\n  }\n\n  // endregion Dispatch commands\n\n  // region Selectors$\n  /** Observable of the collection as a whole */\n  collection$: Observable<EntityCollection<T>> | Store<EntityCollection<T>>;\n\n  /** Observable of count of entities in the cached collection. */\n  count$: Observable<number> | Store<number>;\n\n  /** Observable of all entities in the cached collection. */\n  entities$: Observable<T[]> | Store<T[]>;\n\n  /** Observable of actions related to this entity type. */\n  entityActions$: Observable<EntityAction>;\n\n  /** Observable of the map of entity keys to entities */\n  entityMap$: Observable<Dictionary<T>> | Store<Dictionary<T>>;\n\n  /** Observable of error actions related to this entity type. */\n  errors$: Observable<EntityAction>;\n\n  /** Observable of the filter pattern applied by the entity collection's filter function */\n  filter$: Observable<any> | Store<any>;\n\n  /** Observable of entities in the cached collection that pass the filter function */\n  filteredEntities$: Observable<T[]> | Store<T[]>;\n\n  /** Observable of the keys of the cached collection, in the collection's native sort order */\n  keys$: Observable<string[] | number[]> | Store<string[] | number[]>;\n\n  /** Observable true when the collection has been loaded */\n  loaded$: Observable<boolean> | Store<boolean>;\n\n  /** Observable true when a multi-entity query command is in progress. */\n  loading$: Observable<boolean> | Store<boolean>;\n\n  /** Original entity values for entities with unsaved changes */\n  changeState$: Observable<ChangeStateMap<T>> | Store<ChangeStateMap<T>>;\n\n  // endregion Selectors$\n}\n"]}